import{p as Le,r as v,m as re,e as E,o as Pe,D as ke,w as A,q as U,v as P,x as b,P as J,G as y,u as g,K as $,L as ie,F as O,Q as h,M as z,B as k,H as ue,Z as Re,n as We}from"./vue.esm-bundler-DcuF_pQ3.js";import{_ as X}from"./McSvgIcon-Cq4_nq1C.js";import{_ as N,a as R}from"./McButton-Cw3_qabT.js";import{_ as Ke}from"./McTitle-BRys2FLH.js";import{_ as Be}from"./McFieldSelect-BIwQ6nnt.js";import{_ as Ze}from"./McFieldText-CElXFiE9.js";import{_ as q}from"./McTooltip-CnE_6JSP.js";import{_ as Ae}from"./McFilterTags-XiWv8pFF.js";import{_ as $e}from"./McFilterTypeRange-CHW-wxn9.js";import{_ as Xe}from"./McFilterTypeDate-CjQI6-i1.js";import{_ as qe}from"./McFilterTypeText-Ce38eGkO.js";import{_ as Ye}from"./McFilterTypeRelation-CuWi2XMz.js";import{C as He,_ as Ge}from"./McChip-DqO1iODX.js";import{F as _,d as et,a as D,f as ve}from"./filterMocks-B4PAsX4k.js";import{T as Y,a as H,c as tt}from"./useTooltip-C3VtZaBe.js";import{u as lt}from"./index-BmsK2qgO.js";import"./Sizes-ByFfI8jG.js";import"./Colors-CDVZRUyv.js";import"./FontWeights-CHR9KMRI.js";import"./upperFirst-C9GT4Rcp.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./toString-D6rXdIBz.js";import"./McAvatar-BA28_YXM.js";import"./McPreview-Dmn3-Ll-.js";import"./useFieldErrors-_2MdWRxY.js";import"./Weights-CEN83Yli.js";import"./Spaces-DiQ1o4ZA.js";import"./Alignment-5IJBP4cy.js";import"./dayjs-D83rymJJ.js";import"./iframe-9UevJZ-V.js";import"../sb-preview/runtime.js";import"./McGridRow-TGd0ufJ2.js";import"./McGridCol-B4N2s4LP.js";import"./McFilterChip-C6z-uLuN.js";import"./McDatepicker-D-Jc0kHg.js";import"./index-DRQZTcpU.js";const at={class:"mc-filter"},nt={class:"mc-filter__header"},ot={key:0,class:"mc-filter__presets"},st={class:"mc-filter__body"},rt={class:"mc-filter__body-top"},it={class:"mc-filter__body-top-left"},ut={class:"mc-filter__body-fast-tags-wrapper"},ct={class:"mc-filter__body-bottom"},mt={class:"mc-filter__body-bottom-left"},dt={class:"mc-filter__body-bottom-right"},G=Le({__name:"McFilter",props:{name:{type:String,required:!0},modelValue:{type:Object,required:!0,default:()=>({filter:null,filter_name:null})},filters:{type:Array,required:!0,default:()=>[]},buttonConfirmIsLoading:{type:Boolean,default:!1},useTeleport:{type:Boolean,default:!1},disabledOpen:{type:Boolean,default:!1},useTimezone:{type:Boolean,default:!1},placeholders:{type:Object,default:()=>({})}},emits:["error","clear","delete-preset","update:modelValue","confirm"],setup(F,{emit:fe}){const a=tt(),w=fe,u=F,pe={[_.Relation]:Ye,[_.Date]:Xe,[_.Text]:qe,[_.Range]:$e},V=v(!1),i=v({}),d=v({}),ye=v({}),_e=v({}),I=v(null),f=v(null),S=v(null),Q=v(!1),L=v(null),c=re({scrollPos:0,startClientPos:0,distance:0,isDrag:!1,mouseIsDown:!1}),j=v(""),p=v(null),Je=v(null),n=v(null),M=lt("mcFilterPresets",{}),K=v([]),m=re(a.deepMerge(et,u.placeholders)),Te=E(()=>!T.value||!T.value.type?null:pe[T.value.type]||null),Ue=E(()=>{const e=i.value&&Object.keys(i.value)||[];return u.filters.filter(t=>t.type===_.Fast&&!e.includes(t.value))}),ge=E(()=>u.filters.filter(e=>e.type!==_.Fast)),Ie=E(()=>V.value||!Q.value?"purple-invert":"black-flat"),T=E(()=>u.filters.find(e=>String(e.value)===String(I.value))),Me=E(()=>!a.isEmpty(f.value)&&!!T.value&&T.value.type!==_.Fast),be=E(()=>!j.value.trim());Pe(()=>{B(),document.documentElement.addEventListener("mousemove",ee),document.documentElement.addEventListener("mouseup",te),window.addEventListener("storage",B)}),ke(()=>{document.documentElement.removeEventListener("mousemove",ee),document.documentElement.removeEventListener("mouseup",te),window.removeEventListener("storage",B)});const B=()=>{K.value=M.value[u.name]||[]},we=e=>{const t=e.relation?{[e.relation]:e.default}:e.default;I.value=e.value,x({value:t,valueName:e.name}),le()},Ce=e=>{c.startClientPos=e.clientX,c.mouseIsDown=!0,L.value&&(c.scrollPos=L.value.scrollLeft)},ee=e=>{c.mouseIsDown&&(c.distance=e.clientX-c.startClientPos,Math.abs(c.distance)>2&&!c.isDrag&&(c.isDrag=!0),c.isDrag&&L.value&&L.value.scrollTo({left:c.scrollPos-c.distance}),Math.abs(c.scrollPos)&&(c.scrollPos=0))},te=()=>{c.isDrag&&(c.isDrag=!1),c.mouseIsDown=!1},Ee=e=>{c.isDrag||(p.value&&p.value.name===e.name?(p.value=null,i.value={},d.value={}):(p.value=e,i.value=a.cloneDeep(e.filter),d.value=a.cloneDeep(e.filter_name)),V.value||se())},x=({value:e=null,valueName:t=null})=>{f.value=e,S.value=t},le=()=>{n.value?he():ze()},he=()=>{var e;switch((e=T.value)==null?void 0:e.type){case _.Relation:{De();break}default:{oe();break}}n.value=null},ze=()=>{var e;switch((e=T.value)==null?void 0:e.type){case _.Relation:{Ve();break}default:{oe();break}}n.value=null},De=()=>{const e=n.value.relationKey===D.Exists?[0]:[n.value.value],t={[n.value.category]:{[n.value.relationKey]:e}},l={[I.value]:a.cloneDeep(f.value)};if(a.isEqual(l,t)){w("error",m.messages.same_filter);return}const{category:o,categoryName:s}=ae();if(n.value)if(n.value.relationKey===D.Exists)delete o[n.value.relationKey],delete s[n.value.relationKey];else{const C=o[n.value.relationKey].indexOf(n.value.value);C!==-1&&(o[n.value.relationKey].splice(C,1),a.isEmpty(o[n.value.relationKey])&&delete o[n.value.relationKey],delete s[n.value.relationKey][n.value.value],a.isEmpty(s[n.value.relationKey])&&delete s[n.value.relationKey])}Z(o,s)},Ve=()=>{const{category:e,categoryName:t}=ae();Z(e,t)},ae=()=>{const e=Object.keys(f.value),t=a.cloneDeep(i.value),l=a.cloneDeep(d.value),o=t[I.value],s=l[I.value];return o&&e.forEach(r=>{r===D.Exists?(o[r]=[0],s[r]=[0]):r in o?(o[r]=a.uniqWith([...o[r],...f.value[r]],a.isEqual),s[r]={...s[r],...S.value[r]}):(o[r]=f.value[r],s[r]=S.value[r])}),{category:o,categoryName:s}},Z=(e,t)=>{const l={...i.value,[I.value]:e||f.value};if(a.isEqual(i.value,l)){w("error",m.messages.same_filter);return}i.value=l,d.value={...d.value,[I.value]:t||S.value},ne()},ne=()=>{var e;switch((e=T.value)==null?void 0:e.type){case _.Relation:case _.Date:x({value:null});break;case _.Text:x({value:""});break;case _.Range:x({value:{}});break}},oe=()=>{var e,t,l;if(((e=T.value)==null?void 0:e.type)===_.Range&&Object.keys(f.value||{}).length===2&&((t=f.value)==null?void 0:t.more)>((l=f.value)==null?void 0:l.less)){w("error",m.messages.more_than);return}Z(f.value,f.value)},Qe=e=>{if(n.value=null,a.isEmpty(e)){i.value={},d.value={};return}d.value=a.cloneDeep(e),xe(e)},je=()=>{ye.value=a.cloneDeep(i.value),_e.value=a.cloneDeep(d.value),i.value={},d.value={},w("clear",m.messages.accidentally_cleared)},xe=e=>{const t=a.cloneDeep(e),l=[D.Is,D.IsNot];for(let[o,s]of Object.entries(e))if(s.constructor===Object)for(let[r,C]of Object.entries(s))l.includes(r)&&(C==null?void 0:C.constructor)===Object&&(t[o][r]=[...Object.keys(C)]);i.value=t},Oe=e=>{var o;if(n.value=a.isEqual(n.value,e)?null:e,!n.value){ne();return}let t=null,l=null;e.relationKey?(t={[e.relationKey]:e.relationKey===D.Exists?[0]:[String(e.value)]},l={[e.relationKey]:e.relationKey===D.Exists?[0]:{[e.value]:e.title}}):(t=((o=e.value)==null?void 0:o.constructor)===Object?e.value:String(e.value),l=e.value),I.value=e.category,We(()=>{f.value=t,S.value=l})},se=()=>{const e=btoa(encodeURI(JSON.stringify(d.value))),t={filter:i.value,filter_name:e};w("update:modelValue",t),w("confirm",t),a.isEmpty(i.value)&&(Q.value=!0)},Ne=e=>{var l;const t=(l=M.value[u.name])==null?void 0:l.filter(o=>e&&o.name!==e.name);M.value[u.name]=[...t],Je.value=a.cloneDeep(p.value),p.value=null,i.value={},d.value={},w("delete-preset",m.messages.accidentally_deleted)},Fe=()=>{var l;if(M.value[u.name]&&M.value[u.name].find(o=>{var s,r;return((s=o.name)==null?void 0:s.trim())===((r=j.value)==null?void 0:r.trim())})){w("error",m.messages.same_preset_name);return}const e={name:(l=j.value)==null?void 0:l.trim(),filter:a.cloneDeep(i.value),filter_name:a.cloneDeep(d.value)},t=M.value[u.name];t?M.value[u.name]=[e,...t]:M.value[u.name]=[e],j.value="",p.value={...e}},Se=e=>p.value&&p.value.name===e.name?"purple-invert":"gray-outline";return A(()=>u.modelValue,e=>{const t=e||{filter:null,filter_name:null};if(i.value={...t.filter},t.filter_name)try{d.value=JSON.parse(decodeURI(atob(t.filter_name)))}catch{console.error("Can't parse filters")}Q.value=a.isEmpty(e.filter)||a.isEmpty(e.filter_name)},{deep:!0,immediate:!0}),A(()=>T.value,()=>{x({value:null})},{deep:!0}),A(()=>i.value,(e,t)=>{var l;if(a.isEmpty(t)&&!a.isEmpty(e)&&(Q.value=!1),a.isEmpty((l=u.modelValue)==null?void 0:l.filter)&&a.isEmpty(e)&&(Q.value=!0),p.value){const o=M.value[u.name].map(s=>p.value&&s.name===p.value.name?{name:s.name,filter:a.cloneDeep(i.value),filter_name:a.cloneDeep(d.value)}:s);M.value[u.name]=[...o]}}),(e,t)=>(U(),P("div",at,[b("div",nt,[J(q,{content:m.main_tooltip,placement:g(Y).Top,size:g(H).S},{default:y(()=>[J(N,{variation:Ie.value,disabled:F.disabledOpen,"bg-flat":V.value,size:g(R).MCompact,onClick:t[0]||(t[0]=l=>V.value=!V.value)},{"icon-prepend":y(()=>[J(X,{name:"filter_list"})]),_:1},8,["variation","disabled","bg-flat","size"])]),_:1},8,["content","placement","size"]),K.value?(U(),P("div",ot,[b("div",{ref_key:"dragArea",ref:L,class:"mc-filter__presets-inner",onMousedown:Ce},[(U(!0),P($,null,ie(K.value,l=>(U(),O(N,{key:l.name,variation:Se(l),"secondary-color":"purple",onMouseup:()=>Ee(l)},{default:y(()=>[h(z(l.name),1)]),_:2},1032,["variation","onMouseup"]))),128))],544)])):k("",!0)]),V.value?(U(),O(ue(F.useTeleport?Re:"div"),{key:0,to:"#filterTeleportTarget"},{default:y(()=>[b("div",st,[b("div",rt,[b("div",it,[J(Be,{modelValue:I.value,"onUpdate:modelValue":t[1]||(t[1]=l=>I.value=l),title:m.value,options:ge.value,placeholder:m.choose,"hide-selected":!1,class:"mc-filter__main-select",name:"filter_value_name"},null,8,["modelValue","title","options","placeholder"]),T.value?(U(),P($,{key:0},[(U(),O(ue(Te.value),{"model-value":f.value,filter:T.value,placeholders:m,"current-values":n.value?{}:i.value,"use-timezone":u.useTimezone,"onUpdate:modelValue":x},null,8,["model-value","filter","placeholders","current-values","use-timezone"])),Me.value?(U(),O(N,{key:0,variation:"purple-outline",onClick:le},{default:y(()=>[h(z(m.actions[n.value?"save":"add"]),1)]),_:1})):k("",!0)],64)):k("",!0)])]),J(Ae,{"model-value":d.value,filters:F.filters,placeholders:m,"active-tag":n.value,"use-timezone":u.useTimezone,onTagChange:Qe,onTagClick:Oe,onClear:je},null,8,["model-value","filters","placeholders","active-tag","use-timezone"]),b("section",ut,[(U(!0),P($,null,ie(Ue.value,(l,o)=>(U(),O(q,{key:o,content:l.description||"",placement:g(Y).Top,size:g(H).S},{default:y(()=>[J(Ge,{variation:"gray-outline","text-color":"black",size:g(He).S,onClick:s=>we(l)},{default:y(()=>[h(z(l.name),1)]),_:2},1032,["size","onClick"])]),_:2},1032,["content","placement","size"]))),128))]),b("div",ct,[b("div",mt,[J(N,{disabled:Q.value,loading:F.buttonConfirmIsLoading,size:g(R).S,onClick:se},{default:y(()=>[h(z(m.actions.confirm),1)]),_:1},8,["disabled","loading","size"]),p.value?(U(),O(N,{key:0,variation:"red-outline",size:g(R).S,onClick:t[2]||(t[2]=()=>Ne(p.value))},{"icon-append":y(()=>[J(X,{name:"delete",size:"250",color:"red"})]),default:y(()=>[h(z(m.actions.delete_preset)+" ",1)]),_:1},8,["size"])):k("",!0)]),b("div",dt,[J(Ke,{class:"mc-filter__preset-input-title"},{"icon-append":y(()=>[J(q,{content:m.enter_preset_tooltip,placement:g(Y).Top,size:g(H).S},{default:y(()=>[J(X,{name:"help_solid",size:"250",color:"outline-gray"})]),_:1},8,["content","placement","size"])]),default:y(()=>[h(z(m.create_preset)+" ",1)]),_:1}),J(Ze,{modelValue:j.value,"onUpdate:modelValue":t[3]||(t[3]=l=>j.value=l),placeholder:m.enter_preset_name,"max-length":20,class:"mc-filter__preset-input",name:"preset_name"},null,8,["modelValue","placeholder"]),J(N,{disabled:be.value,variation:"purple-outline",size:g(R).S,onClick:Fe},{default:y(()=>[h(z(m.actions.create),1)]),_:1},8,["disabled","size"])])])])]),_:1})):k("",!0)]))}});G.__docgenInfo={exportName:"default",displayName:"McFilter",description:"",tags:{},props:[{name:"name",description:`Имя фильтра
 (для записи данных в стор)`,type:{name:"string"},required:!0},{name:"modelValue",description:"Значение фильтра",type:{name:"IFilterValue"},required:!0,defaultValue:{func:!0,value:`() =>
  (({
    filter: null,
    filter_name: null
  }) as IFilterValue)`}},{name:"filters",description:"Типы фильтров",type:{name:"IFilter[]"},required:!0,defaultValue:{func:!0,value:"() => []"}},{name:"buttonConfirmIsLoading",description:"Лоадинг кнопки применить фильтр",type:{name:"boolean"},defaultValue:{func:!1,value:"false"}},{name:"useTeleport",description:`Использовать ли teleport (для рендеринга вне компонента)
 Если да то необходимо создать блок с id="filterTeleportTarget" в который будет рендериться тело фильтра`,type:{name:"boolean"},defaultValue:{func:!1,value:"false"}},{name:"disabledOpen",description:"Доступен ли фильтр для открытия",type:{name:"boolean"},defaultValue:{func:!1,value:"false"}},{name:"useTimezone",description:"Нужно ли учитывать часовой пояс при работе с фильтром типа Date",type:{name:"boolean"},defaultValue:{func:!1,value:"false"}},{name:"placeholders",description:"Переводы плейсхолеров и текстов",type:{name:"Partial<IFilterPlaceholders>"},defaultValue:{func:!0,value:"() => ({})"}}],events:[{name:"error",type:{names:["string"]}},{name:"clear",type:{names:["string"]}},{name:"delete-preset",type:{names:["string"]}},{name:"update:modelValue",type:{names:["IFilterValue"]}},{name:"confirm",type:{names:["IFilterValue"]}}],sourceFiles:["/Users/user/Documents/work/mediacube-ui-v2/src/components/patterns/McFilter/McFilter.vue"]};const Xt={title:"McFilter",component:G,tags:["autodocs"],argTypes:{name:{control:"text"},buttonConfirmIsLoading:{control:"boolean"},useTeleport:{control:"boolean"},disabledOpen:{control:"boolean"},useTimezone:{control:"boolean"}},args:{filters:ve,name:"mc-filter",buttonConfirmIsLoading:!1,useTeleport:!1,disabledOpen:!1,useTimezone:!1},parameters:{componentSubtitle:"Status: Ready",design:{type:"figma",url:"https://www.figma.com/file/LXNkU1vlAYmydEiC0l0gDa/MC-Design-System?node-id=1801%3A5024"}}},W={render(){return{data(){return{v:{filter:{email:"McPay",countries:{is:["1","3"]},views_count:{more:1,less:1e4},created_at:{more:"2024-10-01",less:"2024-11-30"},tags:{is:["Piece"]}},filter_name:"JTdCJTIyZW1haWwlMjI6JTIyTWNQYXklMjIsJTIyY291bnRyaWVzJTIyOiU3QiUyMmlzJTIyOiU3QiUyMjElMjI6JTIyJUQwJTkxJUQwJUI1JUQwJUJCJUQwJUIwJUQxJTgwJUQxJTgzJUQxJTgxJUQxJThDJTIyLCUyMjMlMjI6JTIyJUQwJUEzJUQwJUJBJUQxJTgwJUQwJUIwJUQwJUI4JUQwJUJEJUQwJUIwJTIyJTdEJTdELCUyMnZpZXdzX2NvdW50JTIyOiU3QiUyMm1vcmUlMjI6MSwlMjJsZXNzJTIyOjEwMDAwJTdELCUyMmNyZWF0ZWRfYXQlMjI6JTdCJTIybW9yZSUyMjolMjIyMDI0LTEwLTAxJTIyLCUyMmxlc3MlMjI6JTIyMjAyNC0xMS0zMCUyMiU3RCwlMjJ0YWdzJTIyOiU3QiUyMmlzJTIyOiU3QiUyMlBpZWNlJTIyOiUyMlBpZWNlJTIyJTdEJTdEJTdE"}}},components:{McFilter:G},computed:{filters(){return ve}},template:`
            <mc-filter :filters="filters" v-model="v" name="mc-filter"></mc-filter>
            `}}};var ce,me,de;W.parameters={...W.parameters,docs:{...(ce=W.parameters)==null?void 0:ce.docs,source:{originalSource:`{
  render() {
    return {
      data() {
        return {
          v: {
            filter: {
              email: 'McPay',
              countries: {
                is: ['1', '3']
              },
              views_count: {
                more: 1,
                less: 10000
              },
              created_at: {
                more: '2024-10-01',
                less: '2024-11-30'
              },
              tags: {
                is: ['Piece']
              }
            },
            filter_name: 'JTdCJTIyZW1haWwlMjI6JTIyTWNQYXklMjIsJTIyY291bnRyaWVzJTIyOiU3QiUyMmlzJTIyOiU3QiUyMjElMjI6JTIyJUQwJTkxJUQwJUI1JUQwJUJCJUQwJUIwJUQxJTgwJUQxJTgzJUQxJTgxJUQxJThDJTIyLCUyMjMlMjI6JTIyJUQwJUEzJUQwJUJBJUQxJTgwJUQwJUIwJUQwJUI4JUQwJUJEJUQwJUIwJTIyJTdEJTdELCUyMnZpZXdzX2NvdW50JTIyOiU3QiUyMm1vcmUlMjI6MSwlMjJsZXNzJTIyOjEwMDAwJTdELCUyMmNyZWF0ZWRfYXQlMjI6JTdCJTIybW9yZSUyMjolMjIyMDI0LTEwLTAxJTIyLCUyMmxlc3MlMjI6JTIyMjAyNC0xMS0zMCUyMiU3RCwlMjJ0YWdzJTIyOiU3QiUyMmlzJTIyOiU3QiUyMlBpZWNlJTIyOiUyMlBpZWNlJTIyJTdEJTdEJTdE'
          }
        };
      },
      components: {
        McFilter
      },
      computed: {
        filters() {
          return filters;
        }
      },
      template: \`
            <mc-filter :filters="filters" v-model="v" name="mc-filter"></mc-filter>
            \`
    };
  }
}`,...(de=(me=W.parameters)==null?void 0:me.docs)==null?void 0:de.source}}};const qt=["Default"];export{W as Default,qt as __namedExportsOrder,Xt as default};
