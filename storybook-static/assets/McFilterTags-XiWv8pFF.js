import{p as K,r as I,e as h,w as S,q as o,v as b,P as F,G as i,Q as G,M as H,x as O,F as f,K as T,L as C,B as N,u as Q}from"./vue.esm-bundler-DcuF_pQ3.js";import{d as M}from"./dayjs-D83rymJJ.js";import{_ as ee}from"./McButton-Cw3_qabT.js";import{_ as te}from"./McTooltip-CnE_6JSP.js";import{_ as ae}from"./McTitle-BRys2FLH.js";import{_ as q}from"./McGridRow-TGd0ufJ2.js";import{_ as w}from"./McGridCol-B4N2s4LP.js";import{_ as B}from"./McFilterChip-C6z-uLuN.js";import{T as se,a as le,c as re,b as oe}from"./useTooltip-C3VtZaBe.js";import{F as _,a as m}from"./filterMocks-B4PAsX4k.js";const ce={class:"mc-filter-tags"},ne={class:"mc-filter-tags__body"},ie={class:"mc-filter-tags__body-left"},ue={class:"mc-filter-tags__body-right"},me=K({__name:"McFilterTags",props:{modelValue:{type:Object,default:()=>({})},filters:{type:Array,required:!0,default:()=>[]},placeholders:{type:Object,required:!0},activeTag:{type:Object,default:()=>({})},useTimezone:{type:Boolean,default:!0}},emits:["tag-click","tag-change","clear"],setup(z,{emit:U}){const u=re(),y=oe(),E=U,r=z,v=I({}),g=I({}),k=I(null),D=h(()=>V.value.filter(e=>e&&e.type===_.Fast)),Y=h(()=>V.value.filter(e=>e&&e.type!==_.Fast)),V=h(()=>{const e=[];return!u.isEmpty(v.value)&&Object.entries(v.value).forEach(([s,t])=>{const a=r.filters.find(l=>l.value===s);if(a&&a.type===_.Fast)e.push({id:y.timestamp(5),categoryName:a==null?void 0:a.name,category:s,type:_.Fast,...a});else if(a){const l=t.more?`${r.placeholders.from} ${P(t.more,a)}`:"",c=t.less?`${r.placeholders.to} ${P(a.type===_.Date?r.useTimezone?M(t.less).subtract(1,"days").format():M(t.less).format():t.less,a)}`:"",n=typeof t=="object"?`${l}${l&&c?" ":""}${c}`.toLowerCase():t;e.push({id:y.timestamp(5),categoryName:a==null?void 0:a.name,title:n,value:t,category:s})}}),e}),x=h(()=>{let e=[];return u.isEmpty(g.value)||(e=Object.entries(g.value).map(([s,t])=>{if(s===m.Exists){const c=Object.keys(t).map(n=>{const p=r.filters.find(j=>j.value===n);return{id:y.timestamp(5),categoryName:p==null?void 0:p.name,value:n,category:n,relationKey:s,closable:!0}});return[{id:y.timestamp(5),categoryName:r.placeholders.actions.empty,relationKey:m.Exists},...c]}const a=[];return Object.entries(t).forEach(([c,d])=>{const n=r.filters.find(p=>p.value===c);Object.entries(d).forEach(([p,j])=>{a.push({id:y.timestamp(5),categoryName:n==null?void 0:n.name,title:j,value:p,category:c,relationKey:s,closable:!0})})}),[{id:y.timestamp(5),categoryName:r.placeholders.actions[s],relationKey:s},...a]})),e.filter(s=>s.length>1)}),W=h(()=>x.value.length||V.value.length),J=e=>{v.value={},g.value={},!u.isEmpty(e)&&A(e)},A=(e,s=null)=>{const t=[m.Is,m.IsNot,m.Exists];for(let[a,l]of Object.entries(e)){if(t.includes(a)){const d={...a in g.value?g.value[a]:{},...s?{[s]:l}:{}};g.value[a]=d;continue}if(typeof l!="object"&&s){v.value[s]=e;continue}const c=r.filters.find(d=>d.value===a);if(c&&c.type===_.Fast){v.value[a]={value:a};continue}l&&A(l,a)}},L=e=>{k.value=u.isEqual(k.value,e)?null:e,E("tag-click",e)},$=(e,s=null)=>{const t=u.cloneDeep(r.modelValue);switch(s){case m.Exists:delete t[e.category][s];break;case m.Is:case m.IsNot:delete t[e.category][s][e.value],u.isEmpty(t[e.category][s])&&delete t[e.category][s];break;default:delete t[e.category];break}u.isEmpty(t[e.category])&&delete t[e.category],E("tag-change",t)},X=()=>{E("clear")},P=(e,s)=>{switch(s.type){case"date":return M(e).format("DD.MM.YYYY");case"range":return Z(e);default:return e}},Z=e=>e,R=e=>u.isEqual(k.value,e);return S(()=>r.modelValue,e=>{J(e)},{deep:!0,immediate:!0}),S(()=>r.activeTag,e=>{k.value=e},{immediate:!0}),(e,s)=>(o(),b("div",ce,[F(ae,null,{default:i(()=>[G(H(r.placeholders.added_filters),1)]),_:1}),O("div",ne,[O("div",ie,[Y.value.length?(o(),f(q,{key:0,"gutter-x":4,"gutter-y":8},{default:i(()=>[(o(!0),b(T,null,C(Y.value,t=>(o(),f(w,{key:t.id},{default:i(()=>[F(B,{tag:t,"is-active":R(t),closable:"",onClick:()=>L(t),onClose:()=>$(t)},null,8,["tag","is-active","onClick","onClose"])]),_:2},1024))),128))]),_:1})):N("",!0),x.value.length?(o(!0),b(T,{key:1},C(x.value,(t,a)=>(o(),f(q,{key:a,"gutter-x":4,"gutter-y":8},{default:i(()=>[(o(!0),b(T,null,C(t,l=>(o(),f(w,{key:l.id},{default:i(()=>[F(B,{tag:l,"is-active":R(l),closable:l.closable,onClick:()=>L(l),onClose:()=>$(l,t[0].relationKey)},null,8,["tag","is-active","closable","onClick","onClose"])]),_:2},1024))),128))]),_:2},1024))),128)):N("",!0),D.value.length?(o(),f(q,{key:2,"gutter-x":4,"gutter-y":8},{default:i(()=>[(o(!0),b(T,null,C(D.value,t=>(o(),f(w,{key:t.id},{default:i(()=>[F(te,{content:t.description||"",placement:Q(se).Top,size:Q(le).S},{default:i(()=>[F(B,{tag:t,closable:"",onClose:()=>$(t)},null,8,["tag","onClose"])]),_:2},1032,["content","placement","size"])]),_:2},1024))),128))]),_:1})):N("",!0)]),O("div",ue,[W.value?(o(),f(ee,{key:0,variation:"dark-gray-outline",onClick:X},{default:i(()=>[G(H(z.placeholders.actions.clear),1)]),_:1})):N("",!0)])])]))}});me.__docgenInfo={exportName:"default",displayName:"McFilterTags",description:"",tags:{},props:[{name:"modelValue",description:"Данные фильтра",type:{name:"FilterConditionName"},defaultValue:{func:!0,value:"() => ({})"}},{name:"filters",description:"Типы фильтров",type:{name:"IFilter[]"},required:!0,defaultValue:{func:!0,value:"() => []"}},{name:"placeholders",description:"Переводы локализаций",type:{name:"IFilterPlaceholders"},required:!0},{name:"activeTag",description:"Активный тэг",type:{name:"IFilterChip | null"},defaultValue:{func:!0,value:"() => ({})"}},{name:"useTimezone",type:{name:"boolean"},defaultValue:{func:!1,value:"true"}}],events:[{name:"tag-click",type:{names:["IFilterChip"]}},{name:"tag-change",type:{names:["IFilterChip"]}},{name:"clear"}],sourceFiles:["/Users/user/Documents/work/mediacube-ui-v2/src/components/patterns/McFilter/McFilterTags/McFilterTags.vue"]};export{me as _};
